<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Mockup Server Inn Internal (Flask based web app, created by Csaba S.)</title>
    <!-- Include Bootstrap CSS from CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        
</head>
<body class="container mt-4">
    <form id="mockupForm" action="/api" method="POST" onsubmit="submitForm(event)">
        <div class="form-group">
            <label for="request_type">Request Type:</label>
            <select class="form-control" id="request_type" name="request_type">
                <option value="JSON">JSON</option>
                <option value="XML">XML</option>
            </select>
        </div>

        <div class="form-group">
            <label for="response_code">Response Code:</label>
            <input type="text" class="form-control" id="response_code" name="response_code" value="200">
        </div>

        <div class="form-group">
            <label for="request_data">Request Data:</label>
            <textarea class="form-control" id="request_data" name="request_data" rows="10" cols="80"></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Send Request</button>
    </form>
    <br>
    <a href="#" target="_blank" id="view_response_link" class="btn btn-secondary" onclick="openResponsePage()">View Response</a>

    <!-- Include Bootstrap JS and Popper.js from CDN -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
 


    <script>
        function submitForm(event) {
            event.preventDefault();  // Prevent the default form submission
            var form = document.getElementById('mockupForm');
            form.action = '/api';  // Update the action to the API endpoint
            form.method = 'POST';  // Ensure it's a POST request
            var formData = new FormData(form);
        
            fetch(form.action, {
                method: form.method,
                body: formData,
            })
            .then(response => {
                // Check the Content-Type of the response
                var contentType = response.headers.get('Content-Type');
                if (contentType && contentType.includes('application/json')) {
                    return response.json();  // If JSON, parse as JSON
                } else {
                    return response.text();  // If not JSON, treat as plain text
                }
            })
            .then(data => {
                // Handle the response, e.g., update the link to view the response
                return getNextResponseId().then(latestId => {
                    var viewResponseLink = document.getElementById('view_response_link');
                    viewResponseLink.href = `/get_response?id=${latestId}`;
                    window.location.href = `/get_response?id=${latestId}`;
                });
            })
            .catch(error => console.error('Error:', error));
        }
        
        function getNextResponseId() {
            // Fetch the latest response ID from the server
            return fetch('/get_latest_response_id')
                .then(response => response.json())
                .then(data => {
                    return data.latest_response_id;
                })
                .catch(error => console.error('Error fetching latest response ID:', error));
        }
        
    </script>
    
</body>
</html>


